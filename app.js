const contractAddress = '0xC9593A406069ADa45b3E687E1cb0D2C8E120D872';
const contractABI = [{
    "abi_decode_available_length_t_string_memory_ptr": {
					"entryPoint": 2750,
					"id": null,
					"parameterSlots": 3,
					"returnSlots": 1
				},
				"abi_decode_t_string_memory_ptr": {
					"entryPoint": 2815,
					"id": null,
					"parameterSlots": 2,
					"returnSlots": 1
				},
				"abi_decode_t_uint256": {
					"entryPoint": 2291,
					"id": null,
					"parameterSlots": 2,
					"returnSlots": 1
				},
				"abi_decode_t_uint8": {
					"entryPoint": 3025,
					"id": null,
					"parameterSlots": 2,
					"returnSlots": 1
				},
				"abi_decode_tuple_t_string_memory_ptr": {
					"entryPoint": 3269,
					"id": null,
					"parameterSlots": 2,
					"returnSlots": 1
				},
				"abi_decode_tuple_t_string_memory_ptrt_string_memory_ptr": {
					"entryPoint": 2860,
					"id": null,
					"parameterSlots": 2,
					"returnSlots": 2
				},
				"abi_decode_tuple_t_string_memory_ptrt_string_memory_ptrt_uint8": {
					"entryPoint": 3045,
					"id": null,
					"parameterSlots": 2,
					"returnSlots": 3
				},
				"abi_decode_tuple_t_uint256": {
					"entryPoint": 2311,
					"id": null,
					"parameterSlots": 2,
					"returnSlots": 1
				},
				"abi_encode_t_address_to_t_address_fromStack": {
					"entryPoint": 3229,
					"id": null,
					"parameterSlots": 2,
					"returnSlots": 0
				},
				"abi_encode_t_string_memory_ptr_to_t_string_memory_ptr_fromStack": {
					"entryPoint": 2410,
					"id": null,
					"parameterSlots": 2,
					"returnSlots": 1
				},
				"abi_encode_t_string_memory_ptr_to_t_string_memory_ptr_nonPadded_inplace_fromStack": {
					"entryPoint": 3483,
					"id": null,
					"parameterSlots": 2,
					"returnSlots": 1
				},
				"abi_encode_t_string_storage_to_t_string_memory_ptr_nonPadded_inplace_fromStack": {
					"entryPoint": 3862,
					"id": null,
					"parameterSlots": 2,
					"returnSlots": 1
				},
				"abi_encode_t_stringliteral_23bf4b3198ad8d4b0982cb67950b995b31e279f2ae1dd66d6f4202ded6a76661_to_t_string_memory_ptr_fromStack": {
					"entryPoint": 4052,
					"id": null,
					"parameterSlots": 1,
					"returnSlots": 1
				},
				"abi_encode_t_stringliteral_2a1cb988fffa75dab1f18f6e33d352b421b15b8203fb8b7f8559967fd8de80e5_to_t_string_memory_ptr_fromStack": {
					"entryPoint": 3631,
					"id": null,
					"parameterSlots": 1,
					"returnSlots": 1
				},
				"abi_encode_t_stringliteral_913cf84f55278b82b12ffabad3a4aaec752255ab1fedad6f5fe9d181bfc7fba1_to_t_string_memory_ptr_fromStack": {
					"entryPoint": 3735,
					"id": null,
					"parameterSlots": 1,
					"returnSlots": 1
				},
				"abi_encode_t_stringliteral_919de979fbc7d2679198566d39e20aa6ecdf299d7f6efd7dcb4d92ef0a40eb18_to_t_string_memory_ptr_fromStack": {
					"entryPoint": 4925,
					"id": null,
					"parameterSlots": 1,
					"returnSlots": 1
				},
				"abi_encode_t_uint256_to_t_uint256_fromStack": {
					"entryPoint": 3340,
					"id": null,
					"parameterSlots": 2,
					"returnSlots": 0
				},
				"abi_encode_t_uint8_to_t_uint8_fromStack": {
					"entryPoint": 2478,
					"id": null,
					"parameterSlots": 2,
					"returnSlots": 0
				},
				"abi_encode_tuple_packed_t_string_memory_ptr__to_t_string_memory_ptr__nonPadded_inplace_fromStack_reversed": {
					"entryPoint": 3531,
					"id": null,
					"parameterSlots": 2,
					"returnSlots": 1
				},
				"abi_encode_tuple_packed_t_string_storage__to_t_string_memory_ptr__nonPadded_inplace_fromStack_reversed": {
					"entryPoint": 3990,
					"id": null,
					"parameterSlots": 2,
					"returnSlots": 1
				},
				"abi_encode_tuple_t_address__to_t_address__fromStack_reversed": {
					"entryPoint": 3244,
					"id": null,
					"parameterSlots": 2,
					"returnSlots": 1
				},
				"abi_encode_tuple_t_string_memory_ptr_t_string_memory_ptr_t_uint8__to_t_string_memory_ptr_t_string_memory_ptr_t_uint8__fromStack_reversed": {
					"entryPoint": 2493,
					"id": null,
					"parameterSlots": 4,
					"returnSlots": 1
				},
				"abi_encode_tuple_t_stringliteral_23bf4b3198ad8d4b0982cb67950b995b31e279f2ae1dd66d6f4202ded6a76661__to_t_string_memory_ptr__fromStack_reversed": {
					"entryPoint": 4086,
					"id": null,
					"parameterSlots": 1,
					"returnSlots": 1
				},
				"abi_encode_tuple_t_stringliteral_2a1cb988fffa75dab1f18f6e33d352b421b15b8203fb8b7f8559967fd8de80e5__to_t_string_memory_ptr__fromStack_reversed": {
					"entryPoint": 3665,
					"id": null,
					"parameterSlots": 1,
					"returnSlots": 1
				},
				"abi_encode_tuple_t_stringliteral_913cf84f55278b82b12ffabad3a4aaec752255ab1fedad6f5fe9d181bfc7fba1__to_t_string_memory_ptr__fromStack_reversed": {
					"entryPoint": 3769,
					"id": null,
					"parameterSlots": 1,
					"returnSlots": 1
				},
				"abi_encode_tuple_t_stringliteral_919de979fbc7d2679198566d39e20aa6ecdf299d7f6efd7dcb4d92ef0a40eb18__to_t_string_memory_ptr__fromStack_reversed": {
					"entryPoint": 4959,
					"id": null,
					"parameterSlots": 1,
					"returnSlots": 1
				},
				"abi_encode_tuple_t_uint256__to_t_uint256__fromStack_reversed": {
					"entryPoint": 3355,
					"id": null,
					"parameterSlots": 2,
					"returnSlots": 1
				},
				"abi_encode_tuple_t_uint8__to_t_uint8__fromStack_reversed": {
					"entryPoint": 2978,
					"id": null,
					"parameterSlots": 2,
					"returnSlots": 1
				}
            }
];

let provider;
let signer;
let gradeBookContract;

window.addEventListener('load', async function() {
    if (typeof window.ethereum !== 'undefined') {
        provider = new ethers.providers.Web3Provider(window.ethereum);
        await provider.send("eth_requestAccounts", []);
        signer = provider.getSigner();
        gradeBookContract = new ethers.Contract(contractAddress, contractABI, signer);
    } else {
        alert('Please install MetaMask or another Ethereum wallet to use this application.');
    }
});

async function addGrade() {
    const studentName = document.getElementById('studentName').value;
    const subject = document.getElementById('subject').value;
    const grade = document.getElementById('grade').value;

    try {
        const tx = await gradeBookContract.addGrade(studentName, subject, grade);
        await tx.wait();
        alert('Grade added successfully');
    } catch (error) {
        console.error(error);
        alert('An error occurred while adding the grade');
    }
}

async function updateGrade() {
    const studentName = document.getElementById('studentNameUpdate').value;
    const subject = document.getElementById('subjectUpdate').value;
    const grade = document.getElementById('gradeUpdate').value;

    try {
        const tx = await gradeBookContract.updateGrade(studentName, subject, grade);
        await tx.wait();
        alert('Grade updated successfully');
    } catch (error) {
        console.error(error);
        alert('An error occurred while updating the grade');
    }
}

async function getGrade() {
    const studentName = document.getElementById('studentNameGet').value;
    const subject = document.getElementById('subjectGet').value;

    try {
        const result = await gradeBookContract.getGrade(studentName, subject);
        document.getElementById('gradeResult').innerText = `Grade: ${result}`;
    } catch (error) {
        console.error(error);
        alert('An error occurred while retrieving the grade');
    }
}

async function averageGrade() {
    const subject = document.getElementById('subjectAverage').value;

    try {
        const result = await gradeBookContract.averageGrade(subject);
        document.getElementById('averageResult').innerText = `Average Grade: ${result}`;
    } catch (error) {
        console.error(error);
        alert('An error occurred while calculating the average grade');
    }
}
